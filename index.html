<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padjelanta Trek 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <style>
        :root {
            --md-primary: #1a73e8;
            --md-tertiary: #0d652d;
            --md-tertiary-light: #34a853;
            --md-secondary: #e8710a;
            --md-surface: #ffffff;
            --md-surface-dim: #f8f9fa;
            --md-surface-container: #f1f3f4;
            --md-on-surface: #1f1f1f;
            --md-on-surface-variant: #5f6368;
            --md-outline: #dadce0;
            --md-outline-variant: #e8eaed;
            --md-shadow-1: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --md-shadow-2: 0 1px 3px rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--md-surface-dim);
            color: var(--md-on-surface);
            min-height: 100vh;
            overflow: hidden;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            vertical-align: middle;
        }

        /* Header - moved right of zoom controls */
        header {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            position: absolute;
            top: 8px;
            left: 60px;
            right: auto;
            z-index: 1000;
            border-radius: 8px;
            box-shadow: var(--md-shadow-1);
        }

        h1 {
            font-family: 'Google Sans', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            white-space: nowrap;
        }

        h1 span { color: var(--md-tertiary); }

        /* Main layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 440px;
            height: 100vh;
        }

        .map-container { position: relative; }
        #map { width: 100%; height: 100%; }

        /* Progress Card */
        .progress-card {
            position: absolute;
            bottom: 12px;
            left: 12px;
            right: 12px;
            background: var(--md-surface);
            border-radius: 16px;
            box-shadow: var(--md-shadow-2);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .progress-card.collapsed .progress-full { display: none; }
        .progress-card.collapsed .progress-mini { display: flex; }

        .progress-mini {
            display: none;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 1rem;
            cursor: pointer;
        }

        .progress-mini-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-mini-day { font-weight: 500; font-size: 0.8125rem; }
        .progress-mini-name { font-size: 0.6875rem; color: var(--md-on-surface-variant); }
        .progress-mini-km { font-size: 0.8125rem; font-weight: 500; color: var(--md-tertiary); }

        .progress-full { padding: 0.875rem; }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.375rem;
        }

        .progress-day-info {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .progress-day {
            font-family: 'Google Sans', sans-serif;
            font-size: 0.9375rem;
            font-weight: 500;
        }

        .progress-name {
            font-size: 0.8125rem;
            color: var(--md-on-surface-variant);
        }

        .progress-stats {
            display: flex;
            gap: 0.75rem;
            font-size: 0.6875rem;
            color: var(--md-on-surface-variant);
        }

        .progress-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            color: var(--md-on-surface-variant);
            display: none;
        }

        /* Slider */
        .day-slider-container { margin: 0.5rem 0; }

        .day-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: var(--md-outline-variant);
            border-radius: 3px;
            outline: none;
        }

        .day-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--md-tertiary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--md-shadow-1);
        }

        .day-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--md-tertiary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .day-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.25rem;
            font-size: 0.5625rem;
            color: var(--md-on-surface-variant);
        }

        /* Elevation Chart */
        .elevation-chart {
            height: 55px;
            position: relative;
            margin-top: 0.375rem;
        }

        .elevation-svg { width: 100%; height: 100%; }

        .elevation-marker {
            position: absolute;
            top: 0;
            width: 2px;
            height: 45px;
            background: var(--md-secondary);
            display: none;
        }

        .elevation-marker.active { display: block; }

        .elevation-tooltip {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--md-on-surface);
            color: white;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.5625rem;
            white-space: nowrap;
        }

        /* Sidebar */
        .sidebar {
            background: var(--md-surface);
            border-left: 1px solid var(--md-outline);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--md-outline-variant);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--md-on-surface-variant);
        }

        .view-toggle {
            display: flex;
            background: var(--md-surface-container);
            border-radius: 8px;
            padding: 2px;
        }

        .view-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.625rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: var(--md-on-surface-variant);
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--md-surface);
            color: var(--md-on-surface);
            box-shadow: var(--md-shadow-1);
        }

        .view-btn.gpx-complete {
            background: var(--md-tertiary);
            color: white;
            font-weight: 500;
        }

        .view-btn.gpx-complete:hover {
            background: #0a5224;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .sidebar-content::-webkit-scrollbar { width: 6px; }
        .sidebar-content::-webkit-scrollbar-thumb { background: var(--md-outline); border-radius: 3px; }

        .section-title {
            font-size: 0.6875rem;
            font-weight: 500;
            color: var(--md-on-surface-variant);
            margin: 0.75rem 0 0.375rem 0;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .section-title .material-symbols-outlined { font-size: 16px; }

        /* Waypoint Cards - Full View */
        .waypoint-card {
            background: var(--md-surface);
            border: 1px solid var(--md-outline-variant);
            border-radius: 10px;
            margin-bottom: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .waypoint-card:hover { box-shadow: var(--md-shadow-1); }
        .waypoint-card.active { border-color: var(--md-tertiary); box-shadow: var(--md-shadow-2); }
        .waypoint-card.transport { border-left: 3px solid var(--md-primary); }
        .waypoint-card.trek { border-left: 3px solid var(--md-tertiary); }

        .card-main { padding: 0.625rem; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.375rem;
        }

        .card-title {
            font-family: 'Google Sans', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .card-subtitle {
            font-size: 0.625rem;
            color: var(--md-on-surface-variant);
        }

        .card-day {
            font-size: 0.5625rem;
            font-weight: 500;
            padding: 0.125rem 0.3125rem;
            border-radius: 100px;
        }

        .card-day.trek { background: #e8f5e9; color: var(--md-tertiary); }
        .card-day.transport { background: #e3f2fd; color: var(--md-primary); }

        .card-stats {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 0.375rem;
            flex-wrap: wrap;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 0.125rem;
            padding: 0.1875rem 0.375rem;
            background: var(--md-surface-container);
            border-radius: 4px;
            font-size: 0.625rem;
        }

        .stat-badge .material-symbols-outlined { font-size: 12px; }

        .card-details {
            font-size: 0.75rem;
            line-height: 1.5;
            color: var(--md-on-surface-variant);
        }

        .card-coords {
            font-size: 0.5625rem;
            color: var(--md-on-surface-variant);
            font-family: 'Roboto Mono', monospace;
            margin-top: 0.375rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-coords .material-symbols-outlined { font-size: 12px; }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            flex-wrap: wrap;
            gap: 0.375rem;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.1875rem;
        }

        .tag {
            font-size: 0.5625rem;
            padding: 0.125rem 0.3125rem;
            border-radius: 100px;
            font-weight: 500;
        }

        .tag.accommodation { background: #e8f5e9; color: #1b5e20; }
        .tag.food { background: #fff3e0; color: #e65100; }
        .tag.booking { background: #ffebee; color: #c62828; }
        .tag.transport { background: #e3f2fd; color: #1565c0; }
        .tag.activity { background: #f3e5f5; color: #7b1fa2; }

        .gpx-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: var(--md-primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.5625rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .gpx-btn:hover { background: #1557b0; }
        .gpx-btn .material-symbols-outlined { font-size: 14px; }

        .price-badge {
            font-size: 0.6875rem;
            font-weight: 500;
            color: var(--md-tertiary);
        }

        /* Mini Card View */
        .sidebar.mini-view .card-details,
        .sidebar.mini-view .card-coords,
        .sidebar.mini-view .card-footer { display: none; }

        .sidebar.mini-view .waypoint-card { margin-bottom: 0.25rem; }
        .sidebar.mini-view .card-main { padding: 0.5rem; }

        .sidebar.mini-view .card-title {
            font-size: 0.8125rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .sidebar.mini-view .card-stats { margin-bottom: 0; }

        /* Map markers */
        .custom-marker {
            background: var(--md-tertiary);
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: var(--md-shadow-1);
        }

        .custom-marker.transport { background: var(--md-primary); }

        .custom-marker.numbered {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
        }

        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: var(--md-shadow-2);
        }

        .leaflet-popup-content { margin: 0.75rem; }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: var(--map-height, 50vh) 1fr;
            }

            .main-container.large-map { --map-height: 65vh; }
            .main-container.small-map { --map-height: 35vh; }

            header {
                left: 50px;
                top: 6px;
                padding: 0.375rem 0.75rem;
            }

            h1 { font-size: 0.9375rem; }

            .progress-toggle { display: block; }

            .progress-card {
                left: 6px;
                right: 6px;
                bottom: 6px;
            }

            .progress-card.collapsed .progress-mini { display: flex; }

            .sidebar {
                border-left: none;
                border-top: 1px solid var(--md-outline);
            }

            .sidebar-content { padding: 0.375rem; }
        }
    </style>
</head>
<body>
    <div class="main-container" id="mainContainer">
        <div class="map-container">
            <header>
                <h1>Padjelanta <span>Trek</span> 2026</h1>
            </header>
            
            <div id="map"></div>
            
            <div class="progress-card" id="progressCard">
                <div class="progress-mini" onclick="toggleProgressCard()">
                    <div class="progress-mini-left">
                        <span class="progress-mini-day" id="miniDay">Tag 1</span>
                        <span class="progress-mini-name" id="miniName">Vaisaluokta ‚Üí Kutjaure</span>
                    </div>
                    <span class="progress-mini-km" id="miniKm">17 km</span>
                </div>
                
                <div class="progress-full">
                    <div class="progress-header">
                        <div class="progress-day-info">
                            <span class="progress-day" id="currentDay">Tag 1</span>
                            <span class="progress-name" id="currentName">Vaisaluokta ‚Üí Kutjaure</span>
                        </div>
                        <button class="progress-toggle" onclick="toggleProgressCard()">
                            <span class="material-symbols-outlined">expand_more</span>
                        </button>
                    </div>
                    
                    <div class="progress-stats">
                        <span id="dayDistance">17 km</span>
                        <span id="dayAscent">‚Üë 480 hm</span>
                        <span id="dayDescent">‚Üì 370 hm</span>
                        <span id="cumDistance">Gesamt: 17 / 97 km</span>
                    </div>
                    
                    <div class="day-slider-container">
                        <input type="range" class="day-slider" id="daySlider" min="0" max="8" value="1">
                        <div class="day-labels">
                            <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span>
                        </div>
                    </div>
                    
                    <div class="elevation-chart" id="elevationChart">
                        <svg class="elevation-svg" viewBox="0 0 800 50" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="elevGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="#34a853" stop-opacity="0.4"/>
                                    <stop offset="100%" stop-color="#34a853" stop-opacity="0.05"/>
                                </linearGradient>
                            </defs>
                            <path id="elevationArea" fill="url(#elevGradient)" />
                            <path id="elevationLine" fill="none" stroke="#34a853" stroke-width="2" />
                        </svg>
                        <div class="elevation-marker" id="elevMarker">
                            <div class="elevation-tooltip" id="elevTooltip"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Etappen</span>
                <div class="view-toggle">
                    <button class="view-btn gpx-complete" onclick="downloadCompleteGPX()" title="Gesamte Tour als GPX">
                        <span class="material-symbols-outlined" style="font-size:14px">download</span> GPX
                    </button>
                    <button class="view-btn active" onclick="setView('full')" id="fullViewBtn">Voll</button>
                    <button class="view-btn" onclick="setView('mini')" id="miniViewBtn">Mini</button>
                    <button class="view-btn" onclick="toggleMapSize()" id="mapSizeBtn" title="Kartengr√∂√üe">
                        <span class="material-symbols-outlined" style="font-size:14px">aspect_ratio</span>
                    </button>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="section-title">
                    <span class="material-symbols-outlined">train</span>
                    Anreise
                </div>
                <div id="transport-arrival"></div>

                <div class="section-title">
                    <span class="material-symbols-outlined">hiking</span>
                    Trekking
                </div>
                <div id="trek-stages"></div>

                <div class="section-title">
                    <span class="material-symbols-outlined">home</span>
                    Abreise
                </div>
                <div id="transport-departure"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const SEK_TO_EUR = 0.087;
        const NOK_TO_EUR = 0.084;
        
        function formatPrice(sek, nok) {
            if (sek) return `~${Math.round(sek * SEK_TO_EUR)} ‚Ç¨`;
            if (nok) return `~${Math.round(nok * NOK_TO_EUR)} ‚Ç¨`;
            return '';
        }

        function formatCoords(coords) {
            return `${coords[0].toFixed(4)}¬∞N, ${coords[1].toFixed(4)}¬∞E`;
        }

        // View controls
        window.toggleProgressCard = function() {
            document.getElementById('progressCard').classList.toggle('collapsed');
        };

        window.setView = function(view) {
            const sidebar = document.getElementById('sidebar');
            document.getElementById('fullViewBtn').classList.toggle('active', view === 'full');
            document.getElementById('miniViewBtn').classList.toggle('active', view === 'mini');
            sidebar.classList.toggle('mini-view', view === 'mini');
        };

        let mapSizeState = 0;
        window.toggleMapSize = function() {
            const container = document.getElementById('mainContainer');
            container.classList.remove('large-map', 'small-map');
            mapSizeState = (mapSizeState + 1) % 3;
            if (mapSizeState === 1) container.classList.add('large-map');
            else if (mapSizeState === 2) container.classList.add('small-map');
            setTimeout(() => map.invalidateSize(), 300);
        };

        // Coordinates
        const COORDS = {
            stockholm: [59.3293, 18.0686],
            gallivare: [67.1333, 20.65],
            ritsem: [67.72, 17.47],
            vaisaluokta: [67.6878, 17.2508],
            kutjaure: [67.5867, 17.0333],
            laddejahka: [67.4637, 16.9020],
            arasluokta: [67.3739, 16.7999],
            staloluokta: [67.3181, 16.6975],
            staddajahka: [67.2700, 16.5500],
            sarjasjaure: [67.2321, 16.4780],
            sorjushytta: [67.2069, 16.2556],
            nysulitjelma: [67.1401, 16.1375],
            fauske: [67.2596, 15.3911]
        };

        // Detailed route waypoints for GPX export
        const routeWaypoints = {
            'vaisaluokta-kutjaure': [
                COORDS.vaisaluokta, [67.66, 17.20], [67.64, 17.15], [67.62, 17.10], [67.60, 17.05], COORDS.kutjaure
            ],
            'kutjaure-laddejahka': [
                COORDS.kutjaure, [67.56, 17.00], [67.54, 16.97], [67.52, 16.95], [67.50, 16.93], [67.48, 16.91], COORDS.laddejahka
            ],
            'laddejahka-arasluokta': [
                COORDS.laddejahka, [67.45, 16.87], [67.43, 16.84], [67.41, 16.82], [67.39, 16.80], COORDS.arasluokta
            ],
            'arasluokta-staloluokta': [
                COORDS.arasluokta, [67.36, 16.77], [67.35, 16.74], [67.34, 16.71], COORDS.staloluokta
            ],
            'staloluokta-staddajahka': [
                COORDS.staloluokta, [67.31, 16.67], [67.30, 16.63], [67.29, 16.60], [67.28, 16.57], COORDS.staddajahka
            ],
            'staddajahka-sarjasjaure': [
                COORDS.staddajahka, [67.26, 16.53], [67.25, 16.50], COORDS.sarjasjaure
            ],
            'sarjasjaure-sorjushytta': [
                COORDS.sarjasjaure, [67.23, 16.43], [67.22, 16.38], [67.22, 16.33], [67.21, 16.28], COORDS.sorjushytta
            ],
            'sorjushytta-nysulitjelma': [
                COORDS.sorjushytta, [67.19, 16.22], [67.17, 16.19], [67.16, 16.16], COORDS.nysulitjelma
            ]
        };

        // Generate GPX file
        function generateGPX(stageName, waypoints, fromName, toName) {
            const points = waypoints.map(p => `      <trkpt lat="${p[0]}" lon="${p[1]}"></trkpt>`).join('\n');
            return `<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Padjelanta Trek Planner"
     xmlns="http://www.topografix.com/GPX/1/1">
  <metadata>
    <name>Padjelanta Trek: ${fromName} ‚Üí ${toName}</name>
    <desc>Etappe des Padjelanta/Nordkalottleden Treks</desc>
  </metadata>
  <trk>
    <name>${fromName} ‚Üí ${toName}</name>
    <trkseg>
${points}
    </trkseg>
  </trk>
</gpx>`;
        }

        window.downloadGPX = function(stageKey, fromName, toName) {
            const waypoints = routeWaypoints[stageKey];
            if (!waypoints) return;
            
            const gpxContent = generateGPX(stageKey, waypoints, fromName, toName);
            const blob = new Blob([gpxContent], { type: 'application/gpx+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `padjelanta-${stageKey}.gpx`;
            a.click();
            URL.revokeObjectURL(url);
        };

        // Generate complete multi-day GPX for Komoot
        window.downloadCompleteGPX = function() {
            const allWaypoints = [
                { name: 'Vaisaluokta', coords: COORDS.vaisaluokta, desc: 'Start - Tag 1' },
                { name: 'Kutjaure', coords: COORDS.kutjaure, desc: 'Etappe 1 - Tag 1' },
                { name: 'L√•ddej√•hk√•', coords: COORDS.laddejahka, desc: 'Etappe 2 - Tag 2' },
                { name: '√Årasluokta', coords: COORDS.arasluokta, desc: 'Etappe 3 - Tag 3' },
                { name: 'St√°loluokta', coords: COORDS.staloluokta, desc: 'Etappe 4 - Tag 4' },
                { name: 'St√°ddaj√•hk√•', coords: COORDS.staddajahka, desc: 'Etappe 5 - Tag 5' },
                { name: 'S√•rj√•sjaure', coords: COORDS.sarjasjaure, desc: 'Etappe 6 - Tag 6' },
                { name: 'Sorjushytta', coords: COORDS.sorjushytta, desc: 'Etappe 7 - Tag 7 (Norwegen)' },
                { name: 'Ny Sulitjelma', coords: COORDS.nysulitjelma, desc: 'Ziel - Tag 8' }
            ];

            const waypointsXML = allWaypoints.map(wp => `  <wpt lat="${wp.coords[0]}" lon="${wp.coords[1]}">
    <name>${wp.name}</name>
    <desc>${wp.desc}</desc>
  </wpt>`).join('\n');

            const trackpoints = detailedTrekRoute.map(p => `      <trkpt lat="${p[0]}" lon="${p[1]}"></trkpt>`).join('\n');

            const gpxContent = `<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Padjelanta Trek Planner"
     xmlns="http://www.topografix.com/GPX/1/1">
  <metadata>
    <name>Padjelanta Trek 2026 - Komplett</name>
    <desc>97km Mehrtagestrek von Vaisaluokta nach Ny Sulitjelma √ºber den Padjelantaleden und Nordkalottleden. 8 Etappen durch Schwedisch-Lappland und Norwegen.</desc>
    <author>
      <name>Padjelanta Trek Planner</name>
    </author>
  </metadata>
${waypointsXML}
  <trk>
    <name>Padjelanta Trek - Gesamtroute</name>
    <desc>Vaisaluokta ‚Üí Kutjaure ‚Üí L√•ddej√•hk√• ‚Üí √Årasluokta ‚Üí St√°loluokta ‚Üí St√°ddaj√•hk√• ‚Üí S√•rj√•sjaure ‚Üí Sorjushytta ‚Üí Ny Sulitjelma</desc>
    <trkseg>
${trackpoints}
    </trkseg>
  </trk>
</gpx>`;

            const blob = new Blob([gpxContent], { type: 'application/gpx+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'padjelanta-trek-komplett.gpx';
            a.click();
            URL.revokeObjectURL(url);
        };

        const detailedTrekRoute = [
            COORDS.vaisaluokta,
            [67.66, 17.20], [67.64, 17.15], [67.62, 17.10], [67.60, 17.05],
            COORDS.kutjaure,
            [67.56, 17.00], [67.54, 16.97], [67.52, 16.95], [67.50, 16.93], [67.48, 16.91],
            COORDS.laddejahka,
            [67.45, 16.87], [67.43, 16.84], [67.41, 16.82], [67.39, 16.80],
            COORDS.arasluokta,
            [67.36, 16.77], [67.35, 16.74], [67.34, 16.71],
            COORDS.staloluokta,
            [67.31, 16.67], [67.30, 16.63], [67.29, 16.60], [67.28, 16.57],
            COORDS.staddajahka,
            [67.26, 16.53], [67.25, 16.50],
            COORDS.sarjasjaure,
            [67.23, 16.43], [67.22, 16.38], [67.22, 16.33], [67.21, 16.28],
            COORDS.sorjushytta,
            [67.19, 16.22], [67.17, 16.19], [67.16, 16.16],
            COORDS.nysulitjelma
        ];

        const elevationData = [
            { km: 0, elev: 460 }, { km: 5, elev: 580 }, { km: 10, elev: 720 }, { km: 14, elev: 650 },
            { km: 17, elev: 580 }, { km: 22, elev: 700 }, { km: 27, elev: 820 }, { km: 32, elev: 680 },
            { km: 34, elev: 610 }, { km: 38, elev: 750 }, { km: 42, elev: 820 },
            { km: 46, elev: 700 }, { km: 50, elev: 780 }, { km: 54, elev: 650 },
            { km: 56, elev: 603 }, { km: 60, elev: 680 }, { km: 64, elev: 720 },
            { km: 68, elev: 705 }, { km: 71, elev: 780 }, { km: 74, elev: 820 },
            { km: 78, elev: 900 }, { km: 82, elev: 980 }, { km: 86, elev: 850 },
            { km: 89, elev: 950 }, { km: 93, elev: 1050 }, { km: 95, elev: 800 }, { km: 97, elev: 450 }
        ];

        const maxElev = Math.max(...elevationData.map(d => d.elev));
        const minElev = Math.min(...elevationData.map(d => d.elev));
        const maxKm = 97;
        const scaleX = (km) => (km / maxKm) * 800;
        const scaleY = (elev) => 50 - ((elev - minElev) / (maxElev - minElev)) * 40 - 5;

        function buildElevationProfile() {
            let linePath = `M ${scaleX(elevationData[0].km)} ${scaleY(elevationData[0].elev)}`;
            elevationData.forEach(d => { linePath += ` L ${scaleX(d.km)} ${scaleY(d.elev)}`; });
            let areaPath = linePath + ` L ${scaleX(maxKm)} 50 L 0 50 Z`;
            document.getElementById('elevationLine').setAttribute('d', linePath);
            document.getElementById('elevationArea').setAttribute('d', areaPath);
        }
        buildElevationProfile();

        // Day stages data
        const dayStages = [
            { day: 0, from: 'Ritsem', to: 'Vaisaluokta', dist: 0, asc: 0, desc: 0, cumDist: 0, id: 'vaisaluokta', coords: COORDS.vaisaluokta },
            { day: 1, from: 'Vaisaluokta', to: 'Kutjaure', dist: 17, asc: 480, desc: 370, cumDist: 17, id: 'kutjaure', coords: COORDS.kutjaure },
            { day: 2, from: 'Kutjaure', to: 'L√•ddej√•hk√•', dist: 17, asc: 460, desc: 480, cumDist: 34, id: 'laddejahka', coords: COORDS.laddejahka },
            { day: 3, from: 'L√•ddej√•hk√•', to: '√Årasluokta', dist: 12, asc: 410, desc: 410, cumDist: 46, id: 'arasluokta', coords: COORDS.arasluokta },
            { day: 4, from: '√Årasluokta', to: 'St√°loluokta', dist: 10, asc: 300, desc: 280, cumDist: 56, id: 'staloluokta', coords: COORDS.staloluokta },
            { day: 5, from: 'St√°loluokta', to: 'St√°ddaj√•hk√•', dist: 12, asc: 250, desc: 140, cumDist: 68, id: 'staddajahka', coords: COORDS.staddajahka },
            { day: 6, from: 'St√°ddaj√•hk√•', to: 'S√•rj√•sjaure', dist: 6, asc: 170, desc: 60, cumDist: 74, id: 'sarjasjaure', coords: COORDS.sarjasjaure },
            { day: 7, from: 'S√•rj√•sjaure', to: 'Sorjushytta', dist: 12, asc: 190, desc: 180, cumDist: 86, id: 'sorjushytta', coords: COORDS.sorjushytta },
            { day: 8, from: 'Sorjushytta', to: 'Ny Sulitjelma', dist: 11, asc: 390, desc: 630, cumDist: 97, id: 'nysulitjelma', coords: COORDS.nysulitjelma }
        ];

        let currentZoom = 9;

        function updateSlider(dayIndex, scrollToCard = true, panMap = true) {
            const stage = dayStages[dayIndex];
            document.getElementById('currentDay').textContent = dayIndex === 0 ? 'Start' : `Tag ${dayIndex}`;
            document.getElementById('currentName').textContent = `${stage.from} ‚Üí ${stage.to}`;
            document.getElementById('dayDistance').textContent = `${stage.dist} km`;
            document.getElementById('dayAscent').textContent = `‚Üë ${stage.asc} hm`;
            document.getElementById('dayDescent').textContent = `‚Üì ${stage.desc} hm`;
            document.getElementById('cumDistance').textContent = `Gesamt: ${stage.cumDist} / 97 km`;
            
            document.getElementById('miniDay').textContent = dayIndex === 0 ? 'Start' : `Tag ${dayIndex}`;
            document.getElementById('miniName').textContent = `${stage.from} ‚Üí ${stage.to}`;
            document.getElementById('miniKm').textContent = `${stage.dist} km`;
            
            // Elevation marker
            const elevChart = document.getElementById('elevationChart');
            const chartWidth = elevChart.offsetWidth;
            const xPos = (stage.cumDist / maxKm) * chartWidth;
            document.getElementById('elevMarker').style.left = `${xPos}px`;
            document.getElementById('elevMarker').classList.add('active');
            
            const closest = elevationData.reduce((prev, curr) => 
                Math.abs(curr.km - stage.cumDist) < Math.abs(prev.km - stage.cumDist) ? curr : prev
            );
            document.getElementById('elevTooltip').textContent = `${stage.cumDist} km ¬∑ ${closest.elev}m`;

            // Scroll to card and highlight
            if (scrollToCard) {
                const card = document.querySelector(`[data-id="${stage.id}"]`);
                if (card) {
                    document.querySelectorAll('.waypoint-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Pan map without changing zoom
            if (panMap && stage.coords) {
                map.panTo(stage.coords, { animate: true, duration: 0.5 });
                if (markers[stage.id]) {
                    markers[stage.id].openPopup();
                }
            }
        }

        document.getElementById('daySlider').addEventListener('input', (e) => {
            updateSlider(parseInt(e.target.value), true, true);
        });

        // Data
        const transportArrival = [
            {
                id: 'stockholm', name: 'Stockholm', subtitle: 'Startpunkt',
                coords: COORDS.stockholm, type: 'transport', day: 'Anreise',
                details: 'Nachtzug nach G√§llivare. Abfahrt Stockholm Central am Abend, Ankunft am n√§chsten Morgen. Die Zugfahrt f√ºhrt durch das n√§chtliche Schweden und √ºber den Polarkreis.',
                tags: [{ text: 'Nachtzug SJ/VY', type: 'transport' }]
            },
            {
                id: 'gallivare', name: 'G√§llivare', subtitle: 'Umstieg',
                coords: COORDS.gallivare, type: 'transport', day: 'Anreise',
                details: 'Umstieg vom Zug auf den Bus nach Ritsem. Zeit f√ºr Kaffee und letzte Eink√§ufe. Die Busfahrt dauert etwa 3 Stunden durch beeindruckende Landschaft.',
                tags: [{ text: 'Bus', type: 'transport' }]
            },
            {
                id: 'ritsem', name: 'Ritsem', subtitle: 'STF Fj√§llstation',
                coords: COORDS.ritsem, type: 'transport', day: 'Tag 0',
                details: 'Ritsem ist das Tor zum Padjelanta. Die STF-Fj√§llstation bietet Restaurant, Shop und Zimmer. Von hier startet das Boot M/S Storlule √ºber den Akkajaure nach Vaisaluokta.',
                priceSEK: 1260,
                tags: [{ text: 'STF-H√ºtte', type: 'accommodation' }, { text: 'F√§hre', type: 'transport' }]
            }
        ];

        const trekStages = [
            {
                id: 'vaisaluokta', name: 'Vaisaluokta', subtitle: 'Start',
                coords: COORDS.vaisaluokta, type: 'trek', day: 'Tag 1', stageNum: 0,
                distance: 0, ascent: 0, descent: 0, cumDistance: 0,
                details: 'Ankunft per Boot von Ritsem. Die 40-min√ºtige √úberfahrt √ºber den Akkajaure ist bereits ein Erlebnis ‚Äì das m√§chtige √Åhkk√°-Massiv mit seinen Gletschern thront am Horizont. Samische Sommersiedlung mit STF-H√ºtte direkt am Seeufer.',
                priceSEK: 1260,
                tags: [{ text: 'STF-H√ºtte', type: 'accommodation' }],
                gpxKey: null
            },
            {
                id: 'kutjaure', name: 'Kutjaure', subtitle: 'Etappe 1',
                coords: COORDS.kutjaure, type: 'trek', day: 'Tag 1', stageNum: 1,
                distance: 17, ascent: 480, descent: 370, cumDistance: 17,
                details: 'Die erste richtige Wanderetappe durch ein U-f√∂rmiges Tal mit steilen Bergflanken. Man l√§sst die Birkenw√§lder hinter sich und gewinnt an H√∂he. Nahe der H√ºtte lockt ein spektakul√§rer Wasserfall mit H√∂hlen. STF-H√ºtte mit Sauna am See.',
                priceSEK: 1260,
                tags: [{ text: 'STF-H√ºtte', type: 'accommodation' }, { text: 'Sauna', type: 'activity' }],
                gpxKey: 'vaisaluokta-kutjaure', gpxFrom: 'Vaisaluokta', gpxTo: 'Kutjaure'
            },
            {
                id: 'laddejahka', name: 'L√•ddej√•hk√•', subtitle: 'Etappe 2',
                coords: COORDS.laddejahka, type: 'trek', day: 'Tag 2', stageNum: 2,
                distance: 17, ascent: 460, descent: 480, cumDistance: 34,
                details: 'Spektakul√§re Etappe mit drei H√§ngebr√ºcken ‚Äì die letzte ist 100 Meter lang! Von oben er√∂ffnet sich der erste Blick auf den langgestreckten Vastenjaure. Samische H√ºtten mit Shop ‚Äì frischer Fisch und Brot erh√§ltlich.',
                priceSEK: 1500,
                tags: [{ text: 'Badjel√°nnda', type: 'accommodation' }, { text: 'Shop', type: 'food' }],
                gpxKey: 'kutjaure-laddejahka', gpxFrom: 'Kutjaure', gpxTo: 'L√•ddej√•hk√•'
            },
            {
                id: 'arasluokta', name: '√Årasluokta', subtitle: 'Etappe 3',
                coords: COORDS.arasluokta, type: 'trek', day: 'Tag 3', stageNum: 3,
                distance: 12, ascent: 410, descent: 410, cumDistance: 46,
                details: 'K√ºrzere Etappe durch leichtes Gel√§nde. Der Weg f√ºhrt √ºber eine Br√ºcke √ºber den L√•ddej√•hk√• mit tiefer Schlucht. Weite Ausblicke √ºber den See V√°sstenj√°vrre. Samische Siedlung mit Holzkapelle aus 1993.',
                priceSEK: 1500,
                tags: [{ text: 'Badjel√°nnda', type: 'accommodation' }, { text: 'Kapelle', type: 'activity' }],
                gpxKey: 'laddejahka-arasluokta', gpxFrom: 'L√•ddej√•hk√•', gpxTo: '√Årasluokta'
            },
            {
                id: 'staloluokta', name: 'St√°loluokta', subtitle: 'Etappe 4',
                coords: COORDS.staloluokta, type: 'trek', day: 'Tag 4', stageNum: 4,
                distance: 10, ascent: 300, descent: 280, cumDistance: 56,
                details: 'Die sch√∂nste Etappe! Grandioser Blick √ºber den Virihaure ‚Äì t√ºrkisfarbenes Gletscherwasser, norwegische Berge. St√°loluokta ist das Herz des Padjelanta ‚Äì lebendige samische Siedlung mit Torfkoten und sch√∂nster Kotenkirche Schwedens. Kiosk, Sauna, Rentiere.',
                priceSEK: 1600,
                tags: [{ text: 'Badjel√°nnda', type: 'accommodation' }, { text: '‚≠ê Highlight', type: 'activity' }, { text: 'Sauna', type: 'activity' }],
                gpxKey: 'arasluokta-staloluokta', gpxFrom: '√Årasluokta', gpxTo: 'St√°loluokta'
            },
            {
                id: 'staddajahka', name: 'St√°ddaj√•hk√•', subtitle: 'Etappe 5',
                coords: COORDS.staddajahka, type: 'trek', day: 'Tag 5', stageNum: 5,
                distance: 12, ascent: 250, descent: 140, cumDistance: 68,
                details: 'Ab hier wird es einsamer. Route folgt dem Nordkalottleden Richtung Norwegen. Von hier aus: Gipfeltour auf den Jiegn√°ffo (1.700m) m√∂glich ‚Äì 1.000 H√∂henmeter, 360¬∞-Panorama √ºber Padjelanta, Sarek und norwegische Gletscher!',
                priceSEK: 1500,
                tags: [{ text: 'Badjel√°nnda', type: 'accommodation' }, { text: '‚≠ê Gipfeltour', type: 'activity' }],
                gpxKey: 'staloluokta-staddajahka', gpxFrom: 'St√°loluokta', gpxTo: 'St√°ddaj√•hk√•'
            },
            {
                id: 'sarjasjaure', name: 'S√•rj√•sjaure', subtitle: 'Etappe 6',
                coords: COORDS.sarjasjaure, type: 'trek', day: 'Tag 6', stageNum: 6,
                distance: 6, ascent: 170, descent: 60, cumDistance: 74,
                details: 'Kurze Etappe ‚Äì ideal nach Gipfeltour. Mond√§hnliche Landschaft: weite Steinfelder, nur Moose und Flechten. Konsul Perssons H√ºtte liegt spektakul√§r am Rand eines Wasserfalls. Nur 8 Betten ‚Äì absolute Stille der arktischen Wildnis.',
                priceSEK: 1260,
                tags: [{ text: 'STF-H√ºtte', type: 'accommodation' }, { text: '‚ö†Ô∏è Nur 8 Betten', type: 'booking' }],
                gpxKey: 'staddajahka-sarjasjaure', gpxFrom: 'St√°ddaj√•hk√•', gpxTo: 'S√•rj√•sjaure'
            },
            {
                id: 'sorjushytta', name: 'Sorjushytta', subtitle: 'Etappe 7 ‚Äì Norwegen!',
                coords: COORDS.sorjushytta, type: 'trek', day: 'Tag 7', stageNum: 7,
                distance: 12, ascent: 190, descent: 180, cumDistance: 86,
                details: 'Grenz√ºbertritt nach Norwegen! Hochgebirgslandschaft auf √ºber 900m. Blick auf das Sulitelma-Massiv mit Gletschern. Unbemannte DNT-H√ºtte (Schl√ºssel erforderlich). Kein Handynetz, kein flie√üend Wasser ‚Äì pure Wildnis am Ende der Welt.',
                priceNOK: 650,
                tags: [{ text: 'DNT-H√ºtte', type: 'accommodation' }, { text: 'üá≥üá¥ Grenze', type: 'activity' }],
                gpxKey: 'sarjasjaure-sorjushytta', gpxFrom: 'S√•rj√•sjaure', gpxTo: 'Sorjushytta'
            },
            {
                id: 'nysulitjelma', name: 'Ny Sulitjelma', subtitle: 'Etappe 8 ‚Äì Ziel!',
                coords: COORDS.nysulitjelma, type: 'trek', day: 'Tag 8', stageNum: 8,
                distance: 11, ascent: 390, descent: 630, cumDistance: 97,
                details: 'Letzte Etappe: Steil hinauf auf √ºber 1.000m in mond√§hnliche Hochgebirgslandschaft. H√∂chster Punkt der Tour! Steiler Abstieg zur Ny-Sulitjelma Fjellstue mit Strom und flie√üend Wasser. Spuren des historischen Bergbaus. Bus nach Fauske. Geschafft!',
                priceNOK: 650,
                tags: [{ text: 'DNT-H√ºtte', type: 'accommodation' }, { text: 'üèÜ Ziel!', type: 'activity' }],
                gpxKey: 'sorjushytta-nysulitjelma', gpxFrom: 'Sorjushytta', gpxTo: 'Ny Sulitjelma'
            }
        ];

        const transportDeparture = [
            {
                id: 'fauske', name: 'Fauske / Bod√∏', subtitle: 'Bus & Zug',
                coords: COORDS.fauske, type: 'transport', day: 'Abreise',
                details: 'Bus nach Fauske. Anschluss an Nordlandbahn nach Bod√∏ oder Trondheim. Weiter nach Oslo oder mit F√§hre zu den Lofoten.',
                tags: [{ text: 'Bus', type: 'transport' }, { text: 'Nordlandbahn', type: 'transport' }]
            }
        ];

        // Map setup
        const map = L.map('map', { 
            center: [67.4, 16.8], 
            zoom: 9,
            zoomControl: true
        });

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OSM ¬© CARTO',
            maxZoom: 19
        }).addTo(map);

        // Move zoom control to avoid header overlap
        map.zoomControl.setPosition('topleft');

        // Draw routes
        L.polyline(transportArrival.map(p => p.coords), { 
            color: '#1a73e8', weight: 2, dashArray: '6, 6', opacity: 0.7 
        }).addTo(map);
        
        L.polyline(detailedTrekRoute, { 
            color: '#0d652d', weight: 3, opacity: 0.9 
        }).addTo(map);
        
        // Departure route: Ny Sulitjelma -> Fauske -> Stockholm
        L.polyline([COORDS.nysulitjelma, COORDS.fauske], { 
            color: '#1a73e8', weight: 2, dashArray: '6, 6', opacity: 0.7 
        }).addTo(map);
        
        L.polyline([COORDS.fauske, [65.0, 17.5], [63.0, 18.0], COORDS.stockholm], { 
            color: '#1a73e8', weight: 2, dashArray: '6, 6', opacity: 0.7 
        }).addTo(map);

        const markers = {};

        function createMarker(num, type) {
            if (num !== null && num > 0) {
                return L.divIcon({
                    className: `custom-marker ${type} numbered`,
                    html: `<span>${num}</span>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
            }
            return L.divIcon({
                className: `custom-marker ${type}`,
                iconSize: [10, 10],
                iconAnchor: [5, 5]
            });
        }

        function createCard(point, container) {
            const card = document.createElement('div');
            card.className = `waypoint-card ${point.type}`;
            card.dataset.id = point.id;

            let statsHTML = point.distance > 0 ? `
                <div class="card-stats">
                    <div class="stat-badge"><span class="material-symbols-outlined" style="color:#1a73e8">straighten</span>${point.distance} km</div>
                    <div class="stat-badge"><span class="material-symbols-outlined" style="color:#0d652d">trending_up</span>${point.ascent} hm</div>
                    <div class="stat-badge"><span class="material-symbols-outlined" style="color:#e8710a">trending_down</span>${point.descent} hm</div>
                </div>` : '';

            let coordsHTML = `<div class="card-coords"><span class="material-symbols-outlined">location_on</span>${formatCoords(point.coords)}</div>`;

            let gpxBtnHTML = point.gpxKey ? `
                <button class="gpx-btn" onclick="event.stopPropagation(); downloadGPX('${point.gpxKey}', '${point.gpxFrom}', '${point.gpxTo}')">
                    <span class="material-symbols-outlined">download</span>GPX
                </button>` : '';

            let priceHTML = point.priceSEK ? `<span class="price-badge">${formatPrice(point.priceSEK)}/Nacht</span>` : 
                           (point.priceNOK ? `<span class="price-badge">${formatPrice(null, point.priceNOK)}/Nacht</span>` : '');

            card.innerHTML = `
                <div class="card-main">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${point.name}</div>
                            <div class="card-subtitle">${point.subtitle}</div>
                        </div>
                        <div class="card-day ${point.type}">${point.day}</div>
                    </div>
                    ${statsHTML}
                    <div class="card-details">${point.details}</div>
                    ${coordsHTML}
                    <div class="card-footer">
                        <div class="card-tags">${point.tags.map(t => `<span class="tag ${t.type}">${t.text}</span>`).join('')}</div>
                        <div style="display:flex;align-items:center;gap:0.5rem">
                            ${priceHTML}
                            ${gpxBtnHTML}
                        </div>
                    </div>
                </div>`;

            card.addEventListener('click', () => {
                document.querySelectorAll('.waypoint-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                
                // Pan without zoom change
                map.panTo(point.coords, { animate: true, duration: 0.5 });
                if (markers[point.id]) markers[point.id].openPopup();
                
                // Update slider
                if (point.stageNum !== undefined) {
                    document.getElementById('daySlider').value = point.stageNum;
                    updateSlider(point.stageNum, false, false);
                }
            });

            container.appendChild(card);
        }

        function addMarker(point, stageNum = null) {
            const icon = createMarker(stageNum, point.type);
            const marker = L.marker(point.coords, { icon }).addTo(map);

            marker.bindPopup(`
                <div style="font-weight:500;margin-bottom:4px">${point.name}</div>
                <div style="font-size:11px;color:#5f6368">${point.subtitle}</div>
                ${point.distance ? `<div style="font-size:10px;margin-top:4px">${point.distance} km ¬∑ ‚Üë${point.ascent}hm</div>` : ''}
            `, { offset: [0, -5] });

            marker.on('click', () => {
                const card = document.querySelector(`[data-id="${point.id}"]`);
                if (card) {
                    document.querySelectorAll('.waypoint-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    if (point.stageNum !== undefined) {
                        document.getElementById('daySlider').value = point.stageNum;
                        updateSlider(point.stageNum, false, false);
                    }
                }
            });

            markers[point.id] = marker;
        }

        // Build UI
        const arrivalContainer = document.getElementById('transport-arrival');
        const trekContainer = document.getElementById('trek-stages');
        const departureContainer = document.getElementById('transport-departure');

        transportArrival.forEach(p => { createCard(p, arrivalContainer); addMarker(p); });
        trekStages.forEach(p => { createCard(p, trekContainer); addMarker(p, p.stageNum); });
        transportDeparture.forEach(p => { createCard(p, departureContainer); addMarker(p); });

        // Fit bounds
        map.fitBounds(trekStages.map(p => p.coords), { padding: [50, 50] });
        currentZoom = map.getZoom();

        // Initialize
        updateSlider(1, false, false);

        // Collapse on mobile by default
        if (window.innerWidth <= 900) {
            document.getElementById('progressCard').classList.add('collapsed');
        }
    });
    </script>
</body>
</html>
